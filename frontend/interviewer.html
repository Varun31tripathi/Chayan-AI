<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interviewer Dashboard - AI Interview Platform</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">AI Interview Platform</div>
        <div class="nav-links">
            <a href="#">Dashboard</a>
            <a href="#" onclick="toggleCandidates()">Candidates</a>
            <a href="#" onclick="toggleProfile()">Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>
    
    <div class="container">
        <h1 id="interviewerWelcome">Welcome Back, Interviewer!</h1>
        <p class="welcome-text">Manage interviews and evaluate candidates</p>
        
        <div class="dashboard-actions">
            <button class="action-btn" onclick="toggleCreateInterview()">Create New Interview</button>
            <button class="action-btn secondary" onclick="toggleMyInterviews()">My Interviews</button>
            <button class="action-btn secondary" onclick="toggleCandidates()">View Candidates</button>
            <button class="action-btn secondary" onclick="toggleProfile()">Profile</button>
        </div>
        
        <div id="profileSection" class="profile-section" style="display: none;">
            <h2>Interviewer Profile</h2>
            <div class="profile-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="interviewerName" readonly>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="interviewerEmail" readonly>
                </div>
                <div class="form-group">
                    <label>User Type</label>
                    <input type="text" id="interviewerType" readonly>
                </div>
                <div class="form-group">
                    <label>Member Since</label>
                    <input type="text" id="interviewerRegistered" readonly>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <input type="text" id="interviewerRole" readonly>
                </div>
                <div class="form-group">
                    <label>Experience (Years)</label>
                    <input type="number" id="interviewerExperience" readonly>
                </div>
                <button class="action-btn" onclick="editProfile()">Edit Profile</button>
            </div>
        </div>
        
        <div id="myInterviewsSection" class="interviews-section" style="display: none;">
            <h2>My Created Interviews</h2>
            <div class="interviews-list" id="myInterviewsList">
                <p style="text-align: center; color: white; opacity: 0.7;">No interviews created yet.</p>
            </div>
        </div>
        
        <div id="candidatesSection" class="interviews-section" style="display: none;">
            <h2>Candidate Evaluations</h2>
            <div class="interviews-list" id="candidatesList">
                <p style="text-align: center; color: white; opacity: 0.7;">No candidate evaluations available yet.</p>
            </div>
        </div>
        
    </div>

    <!-- Create Interview Popup -->
    <div id="createInterviewPopup" class="popup" style="display: none;">
        <div class="popup-content">
            <span class="close" onclick="closeCreateInterviewPopup()">&times;</span>
            <h2>Create New Interview</h2>
            <form class="profile-form" onsubmit="handleCreateInterview(event)">
                <div class="form-group">
                    <label>Job Title</label>
                    <input type="text" placeholder="e.g., Software Engineer" required>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" placeholder="Company Name" required>
                </div>
                <div class="form-group">
                    <label>Experience Level</label>
                    <select required>
                        <option value="">Select Level</option>
                        <option>Junior</option>
                        <option>Mid-Level</option>
                        <option>Senior</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Interview Duration</label>
                    <select required>
                        <option value="">Select Duration</option>
                        <option>5 minutes</option>
                        <option>10 minutes</option>
                        <option>15 minutes</option>
                        <option>20 minutes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Skills Required</label>
                    <input type="text" placeholder="JavaScript, React, Node.js" required>
                </div>
                <div class="form-group">
                    <label>Job Description</label>
                    <textarea placeholder="Enter job description and requirements..." rows="4" required></textarea>
                </div>
                <button type="submit" class="action-btn">Create Interview</button>
            </form>
        </div>
    </div>

    <script>
        // Check if user is logged in as interviewer and load data
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        if (!currentUser || currentUser.type !== 'interviewer') {
            alert('Please login as interviewer first!');
            window.location.href = 'index.html';
        } else {
            // Load interviewer data
            loadInterviewerData(currentUser);
        }
        
        function loadInterviewerData(user) {
            // Update welcome message
            document.getElementById('interviewerWelcome').textContent = `Welcome Back, ${user.name}!`;
            
            // Update profile fields
            document.getElementById('interviewerName').value = user.name || 'Not provided';
            document.getElementById('interviewerEmail').value = user.email || 'Not provided';
            document.getElementById('interviewerType').value = user.type || 'Interviewer';
            document.getElementById('interviewerRole').value = user.role || 'Not provided';
            document.getElementById('interviewerExperience').value = user.experience || '0';
            
            // Format registration date
            if (user.registeredAt) {
                const date = new Date(user.registeredAt);
                document.getElementById('interviewerRegistered').value = date.toLocaleDateString();
            } else {
                document.getElementById('interviewerRegistered').value = 'Not available';
            }
        }
        
        function toggleMyInterviews() {
            hideAllSections();
            const myInterviewsSection = document.getElementById('myInterviewsSection');
            if (myInterviewsSection) {
                loadMyInterviews();
                myInterviewsSection.style.display = 'block';
            }
        }
        
        async function loadMyInterviews() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) return;
            
            const container = document.getElementById('myInterviewsList');
            
            try {
                const q = window.query(
                    window.collection(window.firebaseDb, 'availableInterviews'),
                    window.where('interviewerEmail', '==', currentUser.email)
                );
                const querySnapshot = await window.getDocs(q);
                const interviews = [];
                
                querySnapshot.forEach((doc) => {
                    interviews.push({ id: doc.id, ...doc.data() });
                });
                
                if (interviews.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: white; opacity: 0.7;">No interviews created yet.</p>';
                    return;
                }
                
                container.innerHTML = interviews.map(interview => `
                    <div class="interview-card">
                        <div class="interview-header">
                            <h3>${interview.title}</h3>
                            <span class="interview-date">${interview.date}</span>
                        </div>
                        <div class="interview-details">
                            <p><strong>Duration:</strong> ${interview.duration}</p>
                            <p><strong>Level:</strong> ${interview.level}</p>
                            <p><strong>Skills:</strong> ${interview.skills}</p>
                            <button class="action-btn" style="background: #f44336; margin-top: 10px;" onclick="deleteInterview('${interview.id}')">Delete Interview</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading interviews:', error);
                container.innerHTML = '<p style="text-align: center; color: white; opacity: 0.7;">Error loading interviews.</p>';
            }
        }
        
        async function deleteInterview(interviewId) {
            if (!confirm('Are you sure you want to delete this interview?')) return;
            
            try {
                await window.deleteDoc(window.doc(window.firebaseDb, 'availableInterviews', interviewId));
                alert('Interview deleted successfully!');
                loadMyInterviews(); // Reload the list
            } catch (error) {
                console.error('Error deleting interview:', error);
                alert('Error deleting interview: ' + error.message);
            }
        }
        
        function hideAllSections() {
            const sections = ['profileSection', 'candidatesSection', 'myInterviewsSection'];
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) section.style.display = 'none';
            });
        }
        
        function loadCandidatesForInterviewer() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (!currentUser) return;
            
            const candidateResults = JSON.parse(localStorage.getItem('candidateResults') || '[]');
            const interviewerCandidates = candidateResults.filter(result => result.interviewerEmail === currentUser.email);
            
            const candidatesList = document.getElementById('candidatesList');
            
            if (interviewerCandidates.length === 0) {
                candidatesList.innerHTML = '<p style="text-align: center; color: white; opacity: 0.7;">No candidate evaluations available yet.</p>';
                return;
            }
            
            candidatesList.innerHTML = interviewerCandidates.map(candidate => `
                <div class="interview-card">
                    <div class="interview-header">
                        <h3>${candidate.candidateName} - ${candidate.jobTitle}</h3>
                        <span class="interview-date">${candidate.completedAt}</span>
                    </div>
                    <div class="interview-details">
                        <p><strong>Score:</strong> ${candidate.score}%</p>
                        <p><strong>Duration:</strong> ${candidate.duration}</p>
                        <p><strong>Status:</strong> <span class="status ${candidate.score >= 80 ? 'passed' : 'pending'}">${candidate.score >= 80 ? 'Recommended' : 'Under Review'}</span></p>
                    </div>
                </div>
            `).join('');
        }
    </script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, query, where, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBCNrh-JW6k-Xy_Fr4uEgC1av2b0bqT3ug",
            authDomain: "ai-interview-platform-da101.firebaseapp.com",
            projectId: "ai-interview-platform-da101",
            storageBucket: "ai-interview-platform-da101.firebasestorage.app",
            messagingSenderId: "1000964103881",
            appId: "1:1000964103881:web:d7b6b9f76c63081eebb718",
            measurementId: "G-PYTF9RLXV0"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.doc = doc;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.query = query;
        window.where = where;
        window.deleteDoc = deleteDoc;
    </script>
    <script src="script.js"></script>
</body>
</html>